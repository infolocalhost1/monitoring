<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Mahasiswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Brand Section -->
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-500 p-3 rounded-full">
                        <i class="fas fa-graduation-cap text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">EduManage</h1>
                        <p class="text-sm text-gray-600">Sistem Manajemen Mahasiswa</p>
                    </div>
                </div>

                <!-- Date Time & Admin Section -->
                <div class="flex items-center space-x-6">
                    <!-- Date Time Section -->
                    <div class="text-right">
                        <div id="currentDate" class="text-lg font-semibold text-gray-800"></div>
                        <div id="currentTime" class="text-2xl font-bold text-blue-600"></div>
                    </div>

                    <!-- Admin Button -->
                    <a href="https://wa.me/6285383587200" target="_blank" 
                       class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors duration-200 shadow-md">
                        <i class="fab fa-whatsapp text-xl"></i>
                        <span class="font-medium">Admin</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="text-center py-8">
            <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-blue-500">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Memuat data dari spreadsheet...
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <strong>Error:</strong> <span id="errorText"></span>
        </div>

        <!-- Summary Cards -->
        <div id="summarySection" class="hidden mb-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4" id="summaryCards">
                <!-- Cards akan diisi oleh JavaScript -->
            </div>
        </div>

        <!-- Layout Bersebelahan: Mahasiswa (Kiri) dan Dosen (Kanan) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Data Mahasiswa Table (Kiri) -->
            <div id="mahasiswaSection" class="bg-white rounded-xl shadow-lg overflow-hidden hidden">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-3">
                    <div class="flex items-center justify-between flex-wrap gap-2">
                        <h2 class="text-xl font-bold text-white flex items-center">
                            <i class="fas fa-users mr-2"></i>
                            Data Mahasiswa
                            <span id="totalMahasiswa" class="ml-2 bg-white bg-opacity-20 px-2 py-1 rounded-full text-xs"></span>
                        </h2>
                        <!-- Search Box for Mahasiswa -->
                        <div class="relative">
                            <input type="text" id="searchMahasiswa" placeholder="Cari mahasiswa..." 
                                   class="bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70 px-3 py-2 rounded-lg focus:outline-none focus:bg-white focus:text-gray-800 focus:placeholder-gray-500 transition-all duration-200 w-48 text-sm">
                            <i class="fas fa-search absolute right-2 top-2.5 text-white opacity-70 text-sm"></i>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-96 overflow-y-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr id="tableHeaders">
                                <!-- Headers akan diisi oleh JavaScript -->
                            </tr>
                        </thead>
                        <tbody id="mahasiswaTable" class="divide-y divide-gray-200">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Mahasiswa -->
                <div class="bg-gray-50 px-4 py-3 border-t">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-700">
                            Menampilkan <span id="mahasiswaStart">1</span> - <span id="mahasiswaEnd">15</span> dari <span id="mahasiswaTotal">0</span> data
                        </div>
                        <div class="flex space-x-2">
                            <button id="mahasiswaPrev" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="mahasiswaPageInfo" class="px-3 py-1 text-sm text-gray-700"></span>
                            <button id="mahasiswaNext" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Grafik Rekrut Dosen (Kanan) -->
            <div id="dosenSection" class="bg-white rounded-xl shadow-lg overflow-hidden hidden">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3">
                    <div class="flex items-center justify-between flex-wrap gap-2">
                        <h2 class="text-xl font-bold text-white flex items-center">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Data Rekrut Dosen
                        </h2>
                        <!-- Search Box for Dosen -->
                        <div class="relative">
                            <input type="text" id="searchDosen" placeholder="Cari dosen..." 
                                   class="bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70 px-3 py-2 rounded-lg focus:outline-none focus:bg-white focus:text-gray-800 focus:placeholder-gray-500 transition-all duration-200 w-48 text-sm">
                            <i class="fas fa-search absolute right-2 top-2.5 text-white opacity-70 text-sm"></i>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-96 overflow-y-auto">
                    <table class="w-full border-collapse">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b">No</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b">Nama Dosen</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b">Jumlah Rekrut</th>
                            </tr>
                        </thead>
                        <tbody id="dosenTable" class="divide-y divide-gray-200">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Dosen -->
                <div class="bg-gray-50 px-4 py-3 border-t">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-700">
                            Menampilkan <span id="dosenStart">1</span> - <span id="dosenEnd">15</span> dari <span id="dosenTotal">0</span> data
                        </div>
                        <div class="flex space-x-2">
                            <button id="dosenPrev" class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="dosenPageInfo" class="px-3 py-1 text-sm text-gray-700"></span>
                            <button id="dosenNext" class="px-3 py-1 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-12">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Informasi Pendaftaran -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-blue-400">
                        <i class="fas fa-clipboard-list mr-2"></i>
                        Informasi Pendaftaran
                    </h3>
                    <div class="space-y-3 text-gray-300">
                        <div class="flex items-center">
                            <i class="fas fa-calendar-alt mr-2 text-blue-400"></i>
                            <span>Periode: 1 Jan - 31 Mar 2024</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-money-bill-wave mr-2 text-green-400"></i>
                            <span>Biaya: Rp 150.000</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-file-alt mr-2 text-yellow-400"></i>
                            <span>Berkas: 5 Dokumen</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock mr-2 text-red-400"></i>
                            <span>Batas: 31 Maret 2024</span>
                        </div>
                        <div class="mt-4">
                            <a href="#" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 inline-flex items-center">
                                <i class="fas fa-download mr-2"></i>
                                Download Brosur
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Kontak Person -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-green-400">
                        <i class="fas fa-users mr-2"></i>
                        Kontak Person
                    </h3>
                    <div class="space-y-4">
                        <!-- Kontak 1 -->
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <div class="font-semibold text-white">Dr. Ahmad Fauzi, M.Pd</div>
                            <div class="text-sm text-gray-400 mb-2">Koordinator Pendaftaran</div>
                            <div class="flex items-center text-sm text-gray-300 mb-1">
                                <i class="fab fa-whatsapp mr-2 text-green-400"></i>
                                <span>+62 812-3456-7890</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-300">
                                <i class="fas fa-envelope mr-2 text-blue-400"></i>
                                <span>ahmad.fauzi@univ.ac.id</span>
                            </div>
                        </div>

                        <!-- Kontak 2 -->
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <div class="font-semibold text-white">Siti Nurhaliza, S.Pd</div>
                            <div class="text-sm text-gray-400 mb-2">Admin Akademik</div>
                            <div class="flex items-center text-sm text-gray-300 mb-1">
                                <i class="fab fa-whatsapp mr-2 text-green-400"></i>
                                <span>+62 813-4567-8901</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-300">
                                <i class="fas fa-envelope mr-2 text-blue-400"></i>
                                <span>siti.nurhaliza@univ.ac.id</span>
                            </div>
                        </div>

                        <!-- Kontak 3 -->
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <div class="font-semibold text-white">Muhammad Rizki, M.A</div>
                            <div class="text-sm text-gray-400 mb-2">Bagian Kemahasiswaan</div>
                            <div class="flex items-center text-sm text-gray-300 mb-1">
                                <i class="fab fa-whatsapp mr-2 text-green-400"></i>
                                <span>+62 814-5678-9012</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-300">
                                <i class="fas fa-envelope mr-2 text-blue-400"></i>
                                <span>muhammad.rizki@univ.ac.id</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fakultas & Program -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-purple-400">
                        <i class="fas fa-university mr-2"></i>
                        Fakultas & Program
                    </h3>
                    
                    <!-- Fakultas Hukum -->
                    <div class="mb-6">
                        <h4 class="font-semibold text-white mb-2 flex items-center">
                            <i class="fas fa-balance-scale mr-2 text-yellow-400"></i>
                            Fakultas Hukum
                        </h4>
                        <ul class="space-y-1 text-gray-300 text-sm ml-6">
                            <li class="flex items-center">
                                <i class="fas fa-chevron-right mr-2 text-xs text-blue-400"></i>
                                Hukum Pidana Islam (HPI)
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-chevron-right mr-2 text-xs text-blue-400"></i>
                                Hukum Keluarga Islam (HKI)
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-chevron-right mr-2 text-xs text-blue-400"></i>
                                Hukum Ekonomi Syariah (HES)
                            </li>
                        </ul>
                    </div>

                    <!-- Fakultas Tarbiyah -->
                    <div>
                        <h4 class="font-semibold text-white mb-2 flex items-center">
                            <i class="fas fa-graduation-cap mr-2 text-green-400"></i>
                            Fakultas Tarbiyah
                        </h4>
                        <ul class="space-y-1 text-gray-300 text-sm ml-6">
                            <li class="flex items-center">
                                <i class="fas fa-chevron-right mr-2 text-xs text-blue-400"></i>
                                Pendidikan Guru Madrasah Ibtidaiyah
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Layanan & Bantuan -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-orange-400">
                        <i class="fas fa-headset mr-2"></i>
                        Layanan & Bantuan
                    </h3>
                    
                    <!-- Quick Links -->
                    <div class="space-y-3 mb-6">
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition-colors duration-200">
                            <i class="fas fa-question-circle mr-2 text-blue-400"></i>
                            FAQ Pendaftaran
                        </a>
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition-colors duration-200">
                            <i class="fas fa-book mr-2 text-green-400"></i>
                            Panduan Lengkap
                        </a>
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition-colors duration-200">
                            <i class="fas fa-video mr-2 text-red-400"></i>
                            Tutorial Video
                        </a>
                        <a href="#" class="flex items-center text-gray-300 hover:text-white transition-colors duration-200">
                            <i class="fas fa-comments mr-2 text-purple-400"></i>
                            Live Chat Support
                        </a>
                    </div>

                    <!-- Jam Operasional -->
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <h4 class="font-semibold text-white mb-2 flex items-center">
                            <i class="fas fa-clock mr-2 text-yellow-400"></i>
                            Jam Operasional
                        </h4>
                        <div class="text-sm text-gray-300 space-y-1">
                            <div>Senin - Jumat: 08:00 - 16:00</div>
                            <div>Sabtu: 08:00 - 12:00</div>
                            <div class="text-red-400">Minggu: Tutup</div>
                        </div>
                    </div>

                    <!-- Social Media -->
                    <div class="mt-4">
                        <h4 class="font-semibold text-white mb-2">Ikuti Kami</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <a href="#" class="bg-blue-600 hover:bg-blue-700 p-2 rounded-lg transition-colors duration-200 flex items-center text-sm">
                                <i class="fab fa-facebook-f mr-2"></i>
                                <span>Facebook</span>
                            </a>
                            <a href="#" class="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 p-2 rounded-lg transition-colors duration-200 flex items-center text-sm">
                                <i class="fab fa-instagram mr-2"></i>
                                <span>Instagram</span>
                            </a>
                            <a href="#" class="bg-red-600 hover:bg-red-700 p-2 rounded-lg transition-colors duration-200 flex items-center text-sm">
                                <i class="fab fa-youtube mr-2"></i>
                                <span>YouTube</span>
                            </a>
                            <a href="#" class="bg-black hover:bg-gray-800 p-2 rounded-lg transition-colors duration-200 flex items-center text-sm">
                                <i class="fab fa-tiktok mr-2"></i>
                                <span>TikTok</span>
                            </a>
                        </div>
                        <div class="text-xs text-gray-400 mt-2">
                            @StaiJannatulFirdaus
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Footer -->
            <div class="border-t border-gray-700 mt-8 pt-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-gray-400 text-sm mb-4 md:mb-0">
                        Â© 2024 EduManage - Sistem Manajemen Mahasiswa. All rights reserved.
                    </div>
                    <div class="flex items-center space-x-4 text-sm text-gray-400">
                        <a href="#" class="hover:text-white transition-colors duration-200">Privacy Policy</a>
                        <span>|</span>
                        <a href="#" class="hover:text-white transition-colors duration-200">Terms of Service</a>
                        <span>|</span>
                        <div class="flex items-center">
                            <i class="fas fa-shield-alt mr-1 text-green-400"></i>
                            <span>Secure System</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // URL API Google Apps Script
        const API_URL = 'https://script.google.com/macros/s/AKfycbxdetUoSh873eSRDGtLp7DZV0lkoAr3zdtLVtXviYYtXKInxCOy-xk1PjifoL-SxDti/exec';
        
        // Variable untuk menyimpan data
        let mahasiswaData = [];
        let dosenData = [];
        let headers = [];
        let filteredMahasiswaData = [];
        let filteredDosenData = [];
        
        // Pagination variables
        let mahasiswaCurrentPage = 1;
        let dosenCurrentPage = 1;
        const itemsPerPage = 15;

        // Update waktu real-time
        function updateDateTime() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                          'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('currentDate').textContent = `${dayName}, ${date} ${month} ${year}`;
            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;
        }

        // Fungsi untuk mengambil data mahasiswa dari API
        async function fetchMahasiswaData() {
            try {
                const response = await fetch(`${API_URL}?action=getMahasiswa`);
                const result = await response.json();
                
                if (result.success) {
                    mahasiswaData = result.data;
                    headers = result.headers || [];
                    return true;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error fetching mahasiswa data:', error);
                showError('Gagal mengambil data mahasiswa: ' + error.message);
                return false;
            }
        }

        // Fungsi untuk mengambil data statistik dosen dari API
        async function fetchDosenStats() {
            try {
                const response = await fetch(`${API_URL}?action=getDosenStats`);
                const result = await response.json();
                
                if (result.success) {
                    dosenData = result.data;
                    return true;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error('Error fetching dosen stats:', error);
                showError('Gagal mengambil statistik dosen: ' + error.message);
                return false;
            }
        }

        // Fungsi untuk menampilkan error
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Fungsi untuk menyembunyikan loading dan menampilkan konten
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('summarySection').classList.remove('hidden');
            document.getElementById('mahasiswaSection').classList.remove('hidden');
            document.getElementById('dosenSection').classList.remove('hidden');
        }

        // Fungsi untuk membuat kartu statistik
        function createSummaryCards() {
            const summaryContainer = document.getElementById('summaryCards');
            summaryContainer.innerHTML = '';
            
            if (mahasiswaData.length === 0) {
                return;
            }
            
            // Hitung total pendaftar
            const totalPendaftar = mahasiswaData.length;
            
            // Cari kolom program pendidikan (coba berbagai kemungkinan nama kolom)
            let programColumn = null;
            const possibleProgramColumns = ['Program Studi', 'Program', 'Prodi', 'Program Pendidikan', 'Jurusan'];
            
            for (let col of possibleProgramColumns) {
                if (headers.includes(col)) {
                    programColumn = col;
                    break;
                }
            }
            
            // Jika tidak ditemukan di headers, cari di data
            if (!programColumn && mahasiswaData.length > 0) {
                const firstRow = mahasiswaData[0];
                const keys = Object.keys(firstRow);
                for (let key of keys) {
                    const lowerKey = key.toLowerCase();
                    if (lowerKey.includes('program') || lowerKey.includes('prodi') || lowerKey.includes('jurusan')) {
                        programColumn = key;
                        break;
                    }
                }
            }
            
            // Hitung statistik per program
            let programStats = {};
            if (programColumn) {
                mahasiswaData.forEach(mahasiswa => {
                    const program = mahasiswa[programColumn] || 'Tidak Diketahui';
                    programStats[program] = (programStats[program] || 0) + 1;
                });
            }
            
            // Buat kartu total pendaftar
            const totalCard = createCard('Total Pendaftar', totalPendaftar, 'fas fa-users', 'bg-gradient-to-r from-blue-500 to-blue-600');
            summaryContainer.appendChild(totalCard);
            
            // Buat kartu untuk semua program (maksimal 4 program)
            const sortedPrograms = Object.entries(programStats)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 4);
            
            const colors = [
                'bg-gradient-to-r from-green-500 to-green-600',
                'bg-gradient-to-r from-purple-500 to-purple-600',
                'bg-gradient-to-r from-orange-500 to-orange-600',
                'bg-gradient-to-r from-red-500 to-red-600'
            ];
            
            sortedPrograms.forEach(([program, count], index) => {
                const programCard = createCard(program, count, 'fas fa-graduation-cap', colors[index]);
                summaryContainer.appendChild(programCard);
            });
        }
        
        // Fungsi helper untuk membuat kartu
        function createCard(title, value, icon, bgClass) {
            const card = document.createElement('div');
            card.className = `${bgClass} rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition-transform duration-200`;
            
            card.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-white text-opacity-80 text-sm font-medium">${title}</p>
                        <p class="text-3xl font-bold mt-1">${value}</p>
                    </div>
                    <div class="bg-white bg-opacity-20 p-3 rounded-full">
                        <i class="${icon} text-2xl"></i>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Fungsi untuk filter data mahasiswa
        function filterMahasiswaData(searchTerm) {
            if (!searchTerm.trim()) {
                filteredMahasiswaData = [...mahasiswaData];
            } else {
                const term = searchTerm.toLowerCase();
                filteredMahasiswaData = mahasiswaData.filter(mahasiswa => {
                    return Object.values(mahasiswa).some(value => 
                        value && value.toString().toLowerCase().includes(term)
                    );
                });
            }
            populateMahasiswaTable();
        }

        // Fungsi untuk filter data dosen
        function filterDosenData(searchTerm) {
            if (!searchTerm.trim()) {
                filteredDosenData = [...dosenData];
            } else {
                const term = searchTerm.toLowerCase();
                filteredDosenData = dosenData.filter(dosen => 
                    dosen.nama.toLowerCase().includes(term)
                );
            }
            dosenCurrentPage = 1; // Reset ke halaman pertama saat search
            populateDosenTable();
        }

        // Fungsi untuk pagination mahasiswa
        function updateMahasiswaPagination() {
            const dataToShow = filteredMahasiswaData.length > 0 ? filteredMahasiswaData : mahasiswaData;
            const totalItems = dataToShow.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            const startIndex = (mahasiswaCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            
            document.getElementById('mahasiswaStart').textContent = totalItems > 0 ? startIndex + 1 : 0;
            document.getElementById('mahasiswaEnd').textContent = endIndex;
            document.getElementById('mahasiswaTotal').textContent = totalItems;
            document.getElementById('mahasiswaPageInfo').textContent = `${mahasiswaCurrentPage} / ${totalPages}`;
            
            document.getElementById('mahasiswaPrev').disabled = mahasiswaCurrentPage <= 1;
            document.getElementById('mahasiswaNext').disabled = mahasiswaCurrentPage >= totalPages;
        }

        // Fungsi untuk pagination dosen
        function updateDosenPagination() {
            const dataToShow = filteredDosenData.length > 0 ? filteredDosenData : dosenData;
            const totalItems = dataToShow.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            const startIndex = (dosenCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            
            document.getElementById('dosenStart').textContent = totalItems > 0 ? startIndex + 1 : 0;
            document.getElementById('dosenEnd').textContent = endIndex;
            document.getElementById('dosenTotal').textContent = totalItems;
            document.getElementById('dosenPageInfo').textContent = `${dosenCurrentPage} / ${totalPages}`;
            
            document.getElementById('dosenPrev').disabled = dosenCurrentPage <= 1;
            document.getElementById('dosenNext').disabled = dosenCurrentPage >= totalPages;
        }

        // Populate tabel mahasiswa dengan data dari API
        function populateMahasiswaTable() {
            console.log('Headers:', headers);
            console.log('Mahasiswa Data:', mahasiswaData);
            
            // Buat header tabel
            const headerRow = document.getElementById('tableHeaders');
            headerRow.innerHTML = '<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">No</th>';
            
            if (headers.length > 0) {
                headers.forEach(header => {
                    headerRow.innerHTML += `<th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">${header}</th>`;
                });
            }

            // Isi data tabel dengan pagination
            const tbody = document.getElementById('mahasiswaTable');
            tbody.innerHTML = '';
            
            const dataToShow = filteredMahasiswaData.length > 0 ? filteredMahasiswaData : mahasiswaData;
            
            if (dataToShow.length === 0) {
                const searchTerm = document.getElementById('searchMahasiswa').value;
                const message = searchTerm ? 'Tidak ada data yang sesuai dengan pencarian' : 'Tidak ada data mahasiswa';
                tbody.innerHTML = `<tr><td colspan="100%" class="px-4 py-3 text-center text-gray-500">${message}</td></tr>`;
                updateMahasiswaPagination();
                return;
            }
            
            // Hitung data untuk halaman saat ini
            const startIndex = (mahasiswaCurrentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = dataToShow.slice(startIndex, endIndex);
            
            currentPageData.forEach((mahasiswa, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors duration-150';
                
                const actualIndex = startIndex + index + 1;
                let rowHTML = `<td class="px-4 py-3 text-sm text-gray-900">${actualIndex}</td>`;
                
                if (headers.length > 0) {
                    headers.forEach(header => {
                        // Coba berbagai kemungkinan key untuk data
                        let value = mahasiswa[header];
                        
                        // Jika tidak ada, coba dengan key yang di-trim
                        if (!value) {
                            const trimmedHeader = header.toString().trim();
                            value = mahasiswa[trimmedHeader];
                        }
                        
                        // Jika masih tidak ada, coba cari key yang mirip
                        if (!value) {
                            const keys = Object.keys(mahasiswa);
                            const matchingKey = keys.find(key => 
                                key.toLowerCase().includes(header.toLowerCase()) ||
                                header.toLowerCase().includes(key.toLowerCase())
                            );
                            if (matchingKey) {
                                value = mahasiswa[matchingKey];
                            }
                        }
                        
                        // Tampilkan value atau '-' jika kosong
                        const displayValue = value && value.toString().trim() !== '' ? value : '-';
                        rowHTML += `<td class="px-4 py-3 text-sm text-gray-700">${displayValue}</td>`;
                    });
                } else {
                    // Fallback jika tidak ada headers - tampilkan semua data
                    Object.values(mahasiswa).forEach(value => {
                        const displayValue = value && value.toString().trim() !== '' ? value : '-';
                        rowHTML += `<td class="px-4 py-3 text-sm text-gray-700">${displayValue}</td>`;
                    });
                }
                
                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            });

            // Update total mahasiswa
            const totalCount = dataToShow.length;
            const totalText = totalCount !== mahasiswaData.length ? 
                `${totalCount} dari ${mahasiswaData.length}` : 
                `${totalCount}`;
            document.getElementById('totalMahasiswa').textContent = totalText;
            
            // Update pagination
            updateMahasiswaPagination();
        }

        // Populate tabel dosen dengan data dari API
        function populateDosenTable() {
            const tbody = document.getElementById('dosenTable');
            tbody.innerHTML = '';
            
            const dataToShow = filteredDosenData.length > 0 ? filteredDosenData : dosenData;
            
            if (dataToShow.length === 0) {
                const searchTerm = document.getElementById('searchDosen').value;
                const message = searchTerm ? 'Tidak ada dosen yang sesuai dengan pencarian' : 'Tidak ada data rekrutmen dosen';
                tbody.innerHTML = `<tr><td colspan="3" class="px-4 py-3 text-center text-gray-500">${message}</td></tr>`;
                updateDosenPagination();
                return;
            }
            
            // Hitung data untuk halaman saat ini
            const startIndex = (dosenCurrentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = dataToShow.slice(startIndex, endIndex);
            
            currentPageData.forEach((dosen, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors duration-150';
                
                const actualIndex = startIndex + index + 1;
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-900">${actualIndex}</td>
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">${dosen.nama}</td>
                    <td class="px-4 py-3 text-sm text-gray-700">
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-semibold">
                            ${dosen.jumlah} mahasiswa
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Update pagination
            updateDosenPagination();
        }

        // Fungsi untuk refresh data
        async function refreshData() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            
            const mahasiswaSuccess = await fetchMahasiswaData();
            const dosenSuccess = await fetchDosenStats();
            
            if (mahasiswaSuccess) {
                filteredMahasiswaData = [...mahasiswaData];
                createSummaryCards();
                populateMahasiswaTable();
            }
            
            if (dosenSuccess) {
                filteredDosenData = [...dosenData];
                populateDosenTable();
            }
            
            if (mahasiswaSuccess || dosenSuccess) {
                hideLoading();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Load data dari API
            refreshData();
            
            // Refresh data setiap 5 menit
            setInterval(refreshData, 300000);
            
            // Event listeners untuk search
            document.getElementById('searchMahasiswa').addEventListener('input', function(e) {
                mahasiswaCurrentPage = 1; // Reset ke halaman pertama saat search
                filterMahasiswaData(e.target.value);
            });
            
            document.getElementById('searchDosen').addEventListener('input', function(e) {
                filterDosenData(e.target.value);
            });
            
            // Event listeners untuk pagination mahasiswa
            document.getElementById('mahasiswaPrev').addEventListener('click', function() {
                if (mahasiswaCurrentPage > 1) {
                    mahasiswaCurrentPage--;
                    populateMahasiswaTable();
                }
            });
            
            document.getElementById('mahasiswaNext').addEventListener('click', function() {
                const dataToShow = filteredMahasiswaData.length > 0 ? filteredMahasiswaData : mahasiswaData;
                const totalPages = Math.ceil(dataToShow.length / itemsPerPage);
                if (mahasiswaCurrentPage < totalPages) {
                    mahasiswaCurrentPage++;
                    populateMahasiswaTable();
                }
            });
            
            // Event listeners untuk pagination dosen
            document.getElementById('dosenPrev').addEventListener('click', function() {
                if (dosenCurrentPage > 1) {
                    dosenCurrentPage--;
                    populateDosenTable();
                }
            });
            
            document.getElementById('dosenNext').addEventListener('click', function() {
                const dataToShow = filteredDosenData.length > 0 ? filteredDosenData : dosenData;
                const totalPages = Math.ceil(dataToShow.length / itemsPerPage);
                if (dosenCurrentPage < totalPages) {
                    dosenCurrentPage++;
                    populateDosenTable();
                }
            });
        });

        // Tambahkan event listener untuk refresh manual (opsional)
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
                e.preventDefault();
                refreshData();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c854cd32b9410c',t:'MTc1NzQzODE2NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
